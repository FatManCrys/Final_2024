---
title: "Covid91 vaccine study Final2024"
author: "David ACevedo"
output: 
  html_document:
    number_sections: true
    toc: true
    toc_depth: 5
date: "`r Sys.Date()`" 
---

```{r include=FALSE,echo=FALSE}
require(tidyverse)
require(tigerstats)
require(forcats)
OldData <-read.csv(file="finalSumr2024.csv",header=TRUE)
#recode to remove the annoying "X" from the dataframe
FinalData <- OldData %>% mutate(infected = recode(infected, covid19 = "covid", none = "OK" )) %>% select(-one_of("X"))
FinalData <- FinalData %>%
mutate(across(where(is.character), as.factor))
FinalData$treatment <- relevel(FinalData$treatment,ref="placebo")
#FinalData$infected <- relevel(FinalData$infected,ref="OK")
Male = filter(FinalData, sex =="M")
Female = filter(FinalData, sex =="F")
Gay = filter(FinalData, LGBTQ =="gay")
DrugUser = filter(FinalData, DrugUser =="yes")
```

# Introduction

A new  preventative vaccine (covid921) is under test in clinical trials. Given the nature of this vaccine it is suspected that the drug may exhibit different effectiveness across the variety of subpopulations tracked. Consider population subgroups by gender( guys and gals), drug use, and sexual orientation. Write a complete report that separately considers this drug for each subgroup and your recommendations as to whether people in the subgroup should take the vaccine. Structure your report in four sections each devoted to one of the four subgroups, use null and alternative hypothesis statements and correct statistical verbage when referencing p-values in conclusions.

## Males

### Summary of Males

```{r}
male_summary <- Male %>%
  group_by(treatment, infected) %>%
  summarise(count = n(), .groups = "drop") %>%
  pivot_wider(names_from = infected, values_from = count, values_fill = 0)
male_summary <- male_summary %>%
  mutate(total = rowSums(select(., -treatment)))
male_column_totals <- male_summary %>%
  summarise(across(where(is.numeric), sum)) %>%
  mutate(treatment = "Total")
male_summary <- bind_rows(male_summary, male_column_totals)
male_summary
```

the summary of males shows that the total males are 18392, 355 of the males have covid whilst 18037 are fine so lets make a visual representation of it with a barplot.

### Visual Results

```{r}
# Bar plot

# Summarize the data for Males by infection status and treatment
male_summary_data <- Male %>%
  group_by(infected, treatment) %>%
  summarize(count = n(), .groups = "drop") %>%
  mutate(prcnt = count / sum(count))

# Bar plot for count of infected vs treatment
male_plot_count <- ggplot(male_summary_data, aes(x = infected, y = count, fill = treatment))
male_plot_count + 
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Number of Males Infected by Treatment",
       x = "Infection Status", y = "Count of Infected Males") +
  scale_fill_manual(values = c("placebo" = "gray", "vaccine" = "green")) +
  theme_minimal()

# Bar plot for percentage of infected vs treatment
male_plot_percent <- ggplot(male_summary_data, aes(x = infected, y = prcnt * 100, fill = treatment))
male_plot_percent + 
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Percentage of Males Infected by Treatment",
       x = "Infection Status", y = "Percentage of Infected Males") +
  scale_fill_manual(values = c("placebo" = "gray", "vaccine" = "green")) +
  theme_minimal()
```

these barplots show us the number of males infected with covid, obvoiusly the males with the vaccine have less covid than the placebo but the results are very much close to eachother but to truly see the results we need a diffrent graph.

### Numerical Results

```{r}
table1 <- xtabs(~infected + treatment, data=Male)
rowPerc(table1)
colPerc(table1)
```

The results show that among the infected males, 73.80% had taken the placebo, and 26.2% had taken the vaccine. For the healthy males, 50.01% had taken the placebo, and 49.99% had taken the vaccine. Overall, 2.82% of males who took the placebo got COVID, compared to 1.02% of those who took the vaccine. This shows that the vaccine helps reduce the chances of getting COVID. These results suggest that the vaccine is effective in lowering COVID infection rates in males, and we can support this by looking at the bar plots.

### Inferential Results
```{r}
chisq.test(table1)
chisqtestGC(table1)
Malefish <- fisher.test(table1)
Malefish
```


The key result is Fisher's Exact Test, with a very small p-value (𝑝=2.2×10−16p=2.2×10 −16) or 0.00000000000000022. This means the differences in infection rates between the vaccine and placebo groups are very unlikely to be random. Because of this, we reject the null hypothesis, which assumes infection rates don't depend on the treatment. The odds ratio of about 2.82 shows that males who got the vaccine were nearly 2.8 times more likely to get COVID compared to those who got the placebo. These results suggest the vaccine is ineffective at preventing COVID in males.

```{r}
male_effect <- Malefish$p.value / (Malefish$p.value + 1)
effectiveness_male <- (1 - 1 / Malefish$estimate) * 100
print(effectiveness_male)

male_low <- (1 - 1 / Malefish$conf.int[1]) * 100
male_hi <- (1 - 1 / Malefish$conf.int[2]) * 100
options(digits = 2)

male_low
male_hi
```

### `r effectiveness_male`% Effectiveness with Confidence Interval: `r male_low`%  to `r male_hi`%

The vaccine's effectiveness in males is above 50%, which suggests it is effective. With a calculated effectiveness of 64.48% and a confidence interval ranging from 54.75% to 72.32%, we can confidently conclude that the vaccine helps reduce infection rates among males.

The null hypothesis (\(H_0\)) proposed that the vaccine has no effect on infection rates, while the alternative hypothesis (\(H_A\)) suggested it does. Based on the very small p-value from Fisher's Exact Test and an odds ratio of 2.82, we reject the null hypothesis and accept the alternative. This supports the conclusion that the vaccine is effective in lowering infection rates in males.

The odds ratio shows that males who received the vaccine were nearly 2.8 times more likely to avoid contracting COVID compared to those who took the placebo. The confidence interval, ranging from 54.75% to 72.32%, further strengthens this finding, confirming the vaccine's significant protective effect.


## Females

### Summary of Females

```{r}
female_summary <- Female %>% 
  group_by(treatment, infected) %>% 
  summarise(count = n(), .groups = "drop") %>% 
  pivot_wider(names_from = infected, values_from = count, values_fill = 0) 
female_summary <- female_summary %>% 
  mutate(total = rowSums(select(., -treatment))) 
female_column_totals <- female_summary %>% 
  summarise(across(where(is.numeric), sum)) %>% 
  mutate(treatment = "Total") 
female_summary <- bind_rows(female_summary, female_column_totals) 
female_summary 
```


There are 18328 females. 365 have covid while 17963 are OK. and 237 have placebo This isn't enough to show a trend so now let us add a barplot for a visual representation 

### Visual Results

```{r}
# Bar plot

# Summarize the data for Females by infection status and treatment
female_summary_data <- Female %>%
  group_by(infected, treatment) %>%
  summarize(count = n(), .groups = "drop") %>%
  mutate(prcnt = count / sum(count))

# Bar plot for count of infected vs treatment
female_plot_count <- ggplot(female_summary_data, aes(x = infected, y = count, fill = treatment))
female_plot_count + 
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Number of Females Infected by Treatment",
       x = "Infection Status", y = "Count of Infected Females") +
  scale_fill_manual(values = c("placebo" = "gray", "vaccine" = "magenta")) +
  theme_minimal()

# Bar plot for percentage of infected vs treatment
female_plot_percent <- ggplot(female_summary_data, aes(x = infected, y = prcnt * 100, fill = treatment))
female_plot_percent + 
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Percentage of Females Infected by Treatment",
       x = "Infection Status", y = "Percentage of Infected Females") +
  scale_fill_manual(values = c("placebo" = "gray", "vaccine" = "magenta")) +
  theme_minimal()
```

The bar plots above illustrate the number of females infected with COVID-19. Visually, it appears that females who received the vaccine have a lower incidence of COVID-19 compared to those who received the placebo. However, the results for both groups are quite close in both graphs. Although there seems to be a visual difference, we need to perform a statistical analysis to determine if this difference is significant.

### Numerical Results
```{r}
table2 <- xtabs(~infected + treatment, data=Female)
rowPerc(table2)
colPerc(table2)
```

The numerical results reveal that among the infected females, 65% had received the placebo, while 35% had received the vaccine. Among those who were not infected, 50% had taken the placebo and 50% had taken the vaccine. Overall, 2.6% of females on the placebo contracted COVID-19 compared to 1.4% on the vaccine, suggesting that the vaccine reduces infection rates. These findings indicate that the vaccine is effective in lowering COVID-19 rates in females, which is consistent with the bar plots demonstrating the vaccine's effectiveness.

### Inferential Results
```{r}
chisq.test(table2)
chisqtestGC(table2)
Femalefish <- fisher.test(table2)
Femalefish
```


The key result to consider is Fisher's Exact Test, which yielded an extremely small p-value (𝑝=1×10−8p=1×10 −8) or 0.00000001, suggesting that the observed differences in infection rates between the vaccine and placebo groups are highly unlikely to be due to chance. This leads to the rejection of the null hypothesis, which assumed that infection rates were independent of the treatment. The odds ratio of approximately 1.9 indicates that females who received the vaccine were nearly 1.9 times more likely to contract COVID-19 compared to those who received the placebo. These findings imply that the vaccine is ineffective at preventing COVID-19 in females.

## LGBTQ



## Druggies


# Overall Results and Conclusions